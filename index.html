<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0">
<title>å³å®¶å®¶æ—ç¨±è¬‚æŸ¥è©¢</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Microsoft JhengHei','PingFang TC',sans-serif;background:#f0f4f8;min-height:100vh}
header{background:linear-gradient(135deg,#2c3e50,#3498db);color:#fff;text-align:center;padding:16px;position:sticky;top:0;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,.2)}
header h1{font-size:20px;margin-bottom:3px}
#inst{font-size:12px;opacity:.9}
#wrap{overflow-x:auto;overflow-y:visible;padding:20px 10px 50px;-webkit-overflow-scrolling:touch}
#tree{position:relative;display:inline-block;min-width:100%}
svg#L{position:absolute;top:0;left:0;pointer-events:none;z-index:1}
svg#L path{fill:none;stroke:#bbb;stroke-width:1.5}
svg#L line{stroke:#e74c3c;stroke-width:1.5;stroke-dasharray:5,3}
.row{display:flex;justify-content:center;align-items:flex-start;gap:10px;position:relative;z-index:2;margin-bottom:10px}
.row.r0{margin-bottom:30px}
.branch{display:flex;flex-direction:column;align-items:center;border:1px solid #dee2e6;border-radius:10px;padding:8px 6px;background:#fff;gap:4px}
.cp{display:flex;gap:4px;align-items:flex-start}
.subfams{display:flex;gap:6px;align-items:flex-start;flex-wrap:wrap;justify-content:center}
.subfam{display:flex;flex-direction:column;align-items:center;gap:3px;border:1px solid #e0e0e0;border-radius:8px;padding:5px 4px;background:#fafbfc}
.kids{display:flex;flex-direction:column;align-items:center;gap:2px}
.p{width:58px;text-align:center;cursor:pointer;transition:transform .1s;position:relative;z-index:2}
.p:hover{transform:scale(1.08)}
.p.sa .a{box-shadow:0 0 0 3px #0d6efd,0 0 10px rgba(13,110,253,.4)}
.p.sb .a{box-shadow:0 0 0 3px #dc3545,0 0 10px rgba(220,53,69,.4)}
.a{width:42px;height:42px;border-radius:50%;margin:0 auto 2px;display:flex;align-items:center;justify-content:center;font-size:16px;border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.12);transition:box-shadow .1s}
.a.m{background:linear-gradient(135deg,#74b9ff,#0984e3)}
.a.f{background:linear-gradient(135deg,#fd79a8,#e84393)}
.p.dead .a{opacity:.4;filter:grayscale(1)}
.p.dead .n{color:#aaa}
.p.dead::after{content:'âœ';position:absolute;top:-2px;right:2px;font-size:10px;color:#999}
.n{font-size:10px;font-weight:600;color:#2d3436;line-height:1.2;white-space:nowrap}
.en{font-size:8px;color:#6c757d;line-height:1;white-space:nowrap}
.zd{font-size:9px;line-height:1;white-space:nowrap}
.g3 .a{width:34px;height:34px;font-size:13px}
.g3 .n{font-size:9px}
.g3 .en{font-size:7px}
.g3{width:48px}
.badge{display:inline-block;padding:0 4px;border-radius:6px;font-size:8px;font-weight:bold;color:#fff;margin-top:1px}
.ba{background:#0d6efd}.bb{background:#dc3545}
#btn{position:fixed;bottom:14px;right:14px;background:#6c757d;color:#fff;border:none;padding:7px 16px;border-radius:18px;cursor:pointer;font-size:12px;box-shadow:0 2px 6px rgba(0,0,0,.2);display:none;z-index:200}
footer{text-align:center;padding:12px;color:#aaa;font-size:10px}
/* Modal */
.modal-bg{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.45);z-index:300;align-items:center;justify-content:center}
.modal-bg.show{display:flex}
.modal{background:#fff;border-radius:16px;padding:24px 20px;max-width:340px;width:90%;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,.3);animation:popIn .2s ease}
@keyframes popIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
.modal .who{font-size:13px;color:#555;margin-bottom:12px}
.modal .who b{color:#2d3436}
.modal .main-term{font-size:36px;font-weight:bold;color:#d63384;margin:8px 0}
.modal .lang-row{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin-top:10px}
.modal .lang{background:#f8f9fa;border-radius:8px;padding:6px 12px;min-width:70px}
.modal .lang .label{font-size:9px;color:#999;text-transform:uppercase}
.modal .lang .val{font-size:14px;font-weight:600;color:#2d3436}
.modal .close-btn{margin-top:16px;background:#6c757d;color:#fff;border:none;padding:8px 28px;border-radius:20px;font-size:13px;cursor:pointer}
.tw-box{background:linear-gradient(135deg,#fff3e0,#ffe0b2);border-radius:10px;padding:10px 14px;margin:12px 0 4px;display:flex;align-items:center;gap:10px;justify-content:center}
.tw-term{font-size:22px;font-weight:bold;color:#e65100}.tw-rom{font-size:12px;color:#bf360c;font-style:italic}
.play-btn{background:#ff6d00;color:#fff;border:none;width:36px;height:36px;border-radius:50%;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(230,81,0,.3);transition:transform .1s}
.play-btn:hover{transform:scale(1.12)}
.play-btn:active{transform:scale(.95)}
/* Status bar for A selection */
#sbar{background:#e3f2fd;color:#1565c0;padding:8px 16px;text-align:center;font-size:14px;font-weight:bold;display:none;border-bottom:2px solid #42a5f5;position:sticky;top:55px;z-index:99}
</style>
</head>
<body>
<header>
<h1>å››ä»£å®¶æ—é—œä¿‚åœ– â€” ç¨±è¬‚æŸ¥è©¢</h1>
<div id="inst">é»é¸ A å†é»é¸ B â†’ é¡¯ç¤ºç¨±è¬‚ï¼ˆä¸­ï¼è‹±ï¼æ³•ï¼ç²µï¼éŸ“ï¼å°èªğŸ”Šï¼‰</div>
</header>
<div id="sbar"></div>
<div id="wrap"><div id="tree"><svg id="L"></svg><div id="g0" class="row r0"></div><div id="g12" class="row"></div></div></div>
<button id="btn" onclick="reset()">æ¸…é™¤</button>
<div class="modal-bg" id="mbg" onclick="closeM(event)"><div class="modal" id="mdl"></div></div>
<footer>å››ä»£å®¶æ—é—œä¿‚åœ–ç³»çµ±</footer>
<script>
const D=[
{id:'gf',n:'å³æœ¨æ—',g:'M',gen:0,d:1},{id:'gm',n:'å³è³´åª›',g:'F',gen:0,d:1},
{id:'fa',n:'å³ä»æ°',g:'M',gen:1,d:1,y:1946},{id:'mo',n:'é­éº—çœŸ',g:'F',gen:1,y:1948},
{id:'dagu',n:'å³éº—é›²',g:'F',gen:1,d:1},{id:'daguh',n:'å½­åŸµæ´º',g:'M',gen:1,y:1947},
{id:'ersh',n:'å³ä»ç‘',g:'M',gen:1},{id:'ershw',n:'æ—å¦‚èŠ³',g:'F',gen:1},
{id:'sansh',n:'å³ä»å˜‰',g:'M',gen:1},{id:'sanshw',n:'ç‹æ¡‚çš‡',g:'F',gen:1},
{id:'xgu',n:'å³éº—æ˜',g:'F',gen:1,d:1},{id:'xguh',n:'æéŒ«éŠ˜',g:'M',gen:1,d:1},
{id:'xsh',n:'å³ä»å’Œ',g:'M',gen:1},{id:'xshw',n:'æ›¾æ›¼éº—',g:'F',gen:1},
{id:'ego',n:'å³åŸ¹å½°',e:'Marc',g:'M',gen:2,y:1974},{id:'csh',n:'é™³æ€æ¨º',e:'Chloe',g:'F',gen:2,y:1975},
{id:'wyx2',n:'å³æ€¡è±',e:'Kama',g:'F',gen:2,y:1976},
{id:'psw',n:'å½­æ¾æ–‡',e:'Kevin',g:'M',gen:2,y:1979},{id:'psww',n:'ä½™çˆç²',g:'F',gen:2,y:1979},
{id:'psk',n:'å½­æ¾å´‘',e:'SKP',g:'M',gen:2,y:1985},{id:'pskw',n:'ç‹æ˜æ€¡',e:'MiMi',g:'F',gen:2,y:1986},
{id:'wzc',n:'å³æ­£æ·³',e:'George',g:'M',gen:2},{id:'wxw',n:'å³æ›‰è‘³',g:'F',gen:2},
{id:'wyx',n:'å³æ€¡æ¬£',e:'Elsa',g:'F',gen:2},{id:'jay',n:'Jay',g:'M',gen:2},
{id:'wyw',n:'å³æ€¡çŸ',e:'Eve',g:'F',gen:2,y:1987},{id:'michael',n:'é„­åšä»',e:'Peter',g:'M',gen:2,y:1983},
{id:'wyh',n:'å³æ€¡è™¹',e:'Elva',g:'F',gen:2,y:1987},{id:'nick',n:'Anthony',g:'M',gen:2},
{id:'wyj',n:'å³æ€¡æ½”',e:'Lisa',g:'F',gen:2,y:1985},{id:'antoine',n:'å¤å°å®‰',e:'Antoine',g:'M',gen:2,y:1989},
{id:'wzg',n:'å³å®—å‰›',e:'Tim',g:'M',gen:2,y:1988},{id:'winnie',n:'é»ƒç©çŠ',e:'Winnie',g:'F',gen:2,y:1988},
{id:'lya',n:'ææ›œå®‰',e:'Jethro',g:'M',gen:2},{id:'polly',n:'Polly',g:'F',gen:2},
{id:'ljy',n:'æå¥æ¯“',e:'Billy',g:'M',gen:2},
{id:'wyq',n:'å³æ€¡å¥‡',e:'Whitley',g:'F',gen:2,y:1986},
{id:'wzh',n:'å³æ­£çš“',e:'Jesse',g:'M',gen:2,y:1988},{id:'lmd',n:'åŠ‰èŠ¸å‡½',e:'Mandy',g:'F',gen:2,y:1989},
{id:'wjy',n:'å³å¥å®‡',e:'Tiger',g:'M',gen:3,y:2006},{id:'cpy',n:'é™³å“è«º',e:'Leo',g:'M',gen:3,y:2008},
{id:'pk1',n:'å½­ç¿Šæ†',e:'Ian',g:'M',gen:3,y:2018},{id:'pk2',n:'å½­ç¿Šå‹›',e:'Edison',g:'M',gen:3,y:2022},
{id:'wmz',n:'å³æ˜å“²',e:'Roger',g:'M',gen:3},{id:'wmy',n:'å³æ˜ä½‘',g:'M',gen:3},{id:'wts',n:'å³äº­è±',g:'F',gen:3},
{id:'cc',n:'CC',g:'M',gen:3},{id:'mila',n:'Mila',g:'F',gen:3},
{id:'bd',n:'é„­æ©å¦®',e:'Libby',g:'F',gen:3,y:2018},{id:'le',n:'é„­æ¥·å¡',e:'Clayton',g:'M',gen:3,y:2020},
{id:'ali',n:'å¤æ„›åŠ›',e:'Alix',g:'F',gen:3,y:2019},
{id:'sz',n:'å³æ¢“é¨«',e:'Eddie',g:'M',gen:3,y:2018},{id:'mochi',n:'å³æ¢“å®¸',e:'Noah',g:'M',gen:3,y:2020},
{id:'mnt',n:'å³é’æ ©',e:'Chelsy',g:'F',gen:3,y:2022},
];
const SP=[['gf','gm'],['fa','mo'],['dagu','daguh'],['ersh','ershw'],['sansh','sanshw'],['xgu','xguh'],['xsh','xshw'],
 ['ego','csh'],['psw','psww'],['psk','pskw'],['wzc','wxw'],['wyx','jay'],['wyw','michael'],['wyh','nick'],
 ['wyj','antoine'],['wzg','winnie'],['lya','polly'],['wzh','lmd']];
const PC=[
 ['gf','fa'],['gm','fa'],['gf','dagu'],['gm','dagu'],['gf','ersh'],['gm','ersh'],
 ['gf','sansh'],['gm','sansh'],['gf','xgu'],['gm','xgu'],['gf','xsh'],['gm','xsh'],
 ['fa','ego'],['mo','ego'],['fa','wyx2'],['mo','wyx2'],
 ['dagu','psw'],['daguh','psw'],['dagu','psk'],['daguh','psk'],
 ['ersh','wzc'],['ershw','wzc'],['ersh','wyx'],['ershw','wyx'],['ersh','wyw'],['ershw','wyw'],['ersh','wyh'],['ershw','wyh'],
 ['sansh','wyj'],['sanshw','wyj'],['sansh','wzg'],['sanshw','wzg'],
 ['xgu','lya'],['xguh','lya'],['xgu','ljy'],['xguh','ljy'],
 ['xsh','wyq'],['xshw','wyq'],['xsh','wzh'],['xshw','wzh'],
 ['ego','wjy'],['csh','wjy'],['ego','cpy'],['csh','cpy'],
 ['psk','pk1'],['pskw','pk1'],['psk','pk2'],['pskw','pk2'],
 ['wzc','wmz'],['wxw','wmz'],['wzc','wmy'],['wxw','wmy'],['wzc','wts'],['wxw','wts'],
 ['wyx','cc'],['jay','cc'],['wyh','mila'],['nick','mila'],
 ['wyw','bd'],['michael','bd'],['wyw','le'],['michael','le'],
 ['wyj','ali'],['antoine','ali'],
 ['wzg','sz'],['winnie','sz'],['wzg','mochi'],['winnie','mochi'],
 ['wzh','mnt'],['lmd','mnt'],
];
const SIB={fa:1,dagu:2,ersh:3,sansh:4,xgu:5,xsh:6};
const AGE={ego:1,wyx2:2,psw:3,psk:4,wzc:5,wyx:6,wyw:7,wyh:8,wyj:9,wzg:10,lya:11,ljy:12,wyq:13,wzh:14,
 csh:1,psww:3,pskw:4,wxw:5,jay:6,michael:7,nick:8,antoine:9,winnie:10,polly:11,lmd:14};

const TW={
'çˆ¸çˆ¸':['é˜¿çˆ¸','a-pah'],'åª½åª½':['é˜¿æ¯','a-bÃº'],'çˆºçˆº':['é˜¿å…¬','a-kong'],'å¥¶å¥¶':['é˜¿å¬¤','a-mÃ¡'],
'å¤–å…¬':['å¤–å…¬','guÄ-kong'],'å¤–å©†':['å¤–å¬¤','guÄ-mÃ¡'],'å…’å­':['å›','kiÃ¡â¿'],'å¥³å…’':['æŸ¥æŸå›','tsa-bÃ³o-kiÃ¡â¿'],
'è€å…¬':['ç¿','ang'],'è€å©†':['æŸ','bÃ³o'],'å“¥å“¥':['é˜¿å…„','a-hiaâ¿'],'å¼Ÿå¼Ÿ':['å°å¼Ÿ','siÃ³-tÄ«'],
'å§å§':['é˜¿å§Š','a-tsÃ­'],'å¦¹å¦¹':['å°å¦¹','siÃ³-muÄ“'],'ä¼¯çˆ¶':['é˜¿ä¼¯','a-peh'],'å”å”':['é˜¿å”','a-tsik'],
'å§‘å§‘':['é˜¿å§‘','a-koo'],'èˆ…èˆ…':['é˜¿èˆ…','a-kÅ«'],'é˜¿å§¨':['é˜¿å§¨','a-Ã®'],
'ä¼¯æ¯':['é˜¿å§†','a-á¸¿'],'å¬¸å¬¸':['é˜¿å¬¸','a-tsÃ­m'],'å§‘ä¸ˆ':['å§‘ä¸ˆ','koo-tiÅ«â¿'],
'èˆ…åª½':['èˆ…å§†','kÅ«-á¸¿'],'å§¨ä¸ˆ':['å§¨ä¸ˆ','Ã®-tiÅ«â¿'],
'å ‚å“¥':['å ‚å…„','tÃ´ng-hiaâ¿'],'å ‚å¼Ÿ':['å ‚å¼Ÿ','tÃ´ng-tÄ«'],'å ‚å§':['å ‚å§Š','tÃ´ng-tsÃ­'],'å ‚å¦¹':['å ‚å¦¹','tÃ´ng-muÄ“'],
'è¡¨å“¥':['è¡¨å…„','piÃ¡u-hiaâ¿'],'è¡¨å¼Ÿ':['è¡¨å¼Ÿ','piÃ¡u-tÄ«'],'è¡¨å§':['è¡¨å§Š','piÃ¡u-tsÃ­'],'è¡¨å¦¹':['è¡¨å¦¹','piÃ¡u-muÄ“'],
'ä¾„å­':['å§ªä»”','tit-Ã¡'],'ä¾„å¥³':['å§ªå¥³','tit-lÃº'],'å¤–ç”¥':['å¤–ç”¥','guÄ-sing'],'å¤–ç”¥å¥³':['å¤–ç”¥å¥³','guÄ-sing-lÃº'],
'å­«å­':['å­«ä»”','sun-Ã¡'],'å­«å¥³':['å­«å¥³','sun-lÃº'],'åª³å©¦':['æ–°å©¦','sin-pÅ«'],'å¥³å©¿':['å›å©¿','kiÃ¡â¿-sÃ i'],
'å…¬å…¬':['å¤§å®˜','ta-kuaâ¿'],'å©†å©†':['å¤§å®¶','ta-ke'],'å²³çˆ¶':['ä¸ˆäºº','tiÅ«â¿-lÃ¢ng'],'å²³æ¯':['ä¸ˆå§†','tiÅ«â¿-á¸¿'],
'å«‚å«‚':['é˜¿å«‚','a-sÃ³'],'å¼Ÿåª³':['å¼Ÿå©¦','tÄ“-hÅ«'],'å§å¤«':['å§Šå¤«','tsÃ­-hu'],'å¦¹å¤«':['å¦¹å©¿','muÄ“-sÃ i'],
'æ›¾ç¥–çˆ¶':['é˜¿ç¥–','a-tsÃ³o'],'æ›¾ç¥–æ¯':['é˜¿ç¥–åª½','a-tsÃ³o-mÃ¡'],
'å¤–æ›¾ç¥–çˆ¶':['å¤–é˜¿ç¥–','guÄ-a-tsÃ³o'],'å¤–æ›¾ç¥–æ¯':['å¤–é˜¿ç¥–åª½','guÄ-a-tsÃ³o-mÃ¡'],
'æ›¾å­«':['æ›¾å­«','tsing-sun'],'æ›¾å­«å¥³':['æ›¾å­«å¥³','tsing-sun-lÃº'],
'å¤–æ›¾å­«':['å¤–æ›¾å­«','guÄ-tsing-sun'],'å¤–æ›¾å­«å¥³':['å¤–æ›¾å­«å¥³','guÄ-tsing-sun-lÃº'],
'ä¼¯å…¬':['ä¼¯å…¬','peh-kong'],'å”å…¬':['å”å…¬','tsik-kong'],'å§‘å©†':['å§‘å©†','koo-pÃ´'],
'ä¼¯å©†':['ä¼¯å©†','peh-pÃ´'],'å¬¸å©†':['å¬¸å©†','tsÃ­m-pÃ´'],'å§‘ä¸ˆå…¬':['å§‘ä¸ˆå…¬','koo-tiÅ«â¿-kong'],
'ä¾„å­«':['å§ªå­«','tit-sun'],'ä¾„å­«å¥³':['å§ªå­«å¥³','tit-sun-lÃº'],
'å¤–ç”¥å­«':['å¤–ç”¥å­«','guÄ-sing-sun'],'å¤–ç”¥å­«å¥³':['å¤–ç”¥å­«å¥³','guÄ-sing-sun-lÃº'],
'å¤§ä¼¯':['å¤§ä¼¯','tuÄ-peh'],'å°å”':['å°å”','siÃ³-tsik'],'å§‘å­':['å§‘ä»”','koo-Ã¡'],
'èˆ…å­':['èˆ…ä»”','kÅ«-Ã¡'],'å¤§å§¨å­':['å¤§å§¨','tuÄ-Ã®'],'å°å§¨å­':['å°å§¨','siÃ³-Ã®'],
'å ‚ä¼¯':['å ‚ä¼¯','tÃ´ng-peh'],'å ‚å”':['å ‚å”','tÃ´ng-tsik'],'å ‚å§‘':['å ‚å§‘','tÃ´ng-koo'],
'è¡¨ä¼¯':['è¡¨ä¼¯','piÃ¡u-peh'],'è¡¨å”':['è¡¨å”','piÃ¡u-tsik'],'è¡¨å§‘':['è¡¨å§‘','piÃ¡u-koo'],
'å ‚ä¾„':['å ‚å§ª','tÃ´ng-tit'],'å ‚ä¾„å¥³':['å ‚å§ªå¥³','tÃ´ng-tit-lÃº'],
'è¡¨ä¾„':['è¡¨å§ª','piÃ¡u-tit'],'è¡¨ä¾„å¥³':['è¡¨å§ªå¥³','piÃ¡u-tit-lÃº'],
'å ‚ä¼¯æ¯':['å ‚å§†','tÃ´ng-á¸¿'],'å ‚å¬¸':['å ‚å¬¸','tÃ´ng-tsÃ­m'],'å ‚å§‘ä¸ˆ':['å ‚å§‘ä¸ˆ','tÃ´ng-koo-tiÅ«â¿'],
'è¡¨ä¼¯æ¯':['è¡¨å§†','piÃ¡u-á¸¿'],'è¡¨å¬¸':['è¡¨å¬¸','piÃ¡u-tsÃ­m'],'è¡¨å§‘ä¸ˆ':['è¡¨å§‘ä¸ˆ','piÃ¡u-koo-tiÅ«â¿'],
'å ‚å§å¤«':['å ‚å§Šå¤«','tÃ´ng-tsÃ­-hu'],'å ‚å¦¹å¤«':['å ‚å¦¹å©¿','tÃ´ng-muÄ“-sÃ i'],
'å ‚å«‚':['å ‚å«‚','tÃ´ng-sÃ³'],'å ‚å¼Ÿåª³':['å ‚å¼Ÿå©¦','tÃ´ng-tÄ“-hÅ«'],
'è¡¨å§å¤«':['è¡¨å§Šå¤«','piÃ¡u-tsÃ­-hu'],'è¡¨å¦¹å¤«':['è¡¨å¦¹å©¿','piÃ¡u-muÄ“-sÃ i'],
'è¡¨å«‚':['è¡¨å«‚','piÃ¡u-sÃ³'],'è¡¨å¼Ÿåª³':['è¡¨å¼Ÿå©¦','piÃ¡u-tÄ“-hÅ«'],
'è‡ªå·±':['å®¶å·±','ka-kÄ«'],'ç„¡é—œä¿‚':['ç„¡é—œä¿‚','bÃ´-kuan-hÄ“'],'è¦ªæˆš':['è¦ªæƒ…','tshin-tsiÃ¢â¿'],
'å”ä¼¯è¼©':['å”ä¼¯è¼©','tsik-peh-puÃ¨'],'å§‘å§¨è¼©':['å§‘å§¨è¼©','koo-Ã®-puÃ¨'],
'ä¾„è¼©':['å§ªè¼©','tit-puÃ¨'],'ä¾„å¥³è¼©':['å§ªå¥³è¼©','tit-lÃº-puÃ¨'],
'ç¥–è¼©':['ç¥–è¼©','tsÃ³o-puÃ¨'],'å­«è¼©':['å­«è¼©','sun-puÃ¨'],'å¹³è¼©':['å¹³è¼©','pÃªnn-puÃ¨'],
};
const KR={
'çˆ¸çˆ¸':'ì•„ë²„ì§€','åª½åª½':'ì–´ë¨¸ë‹ˆ','çˆºçˆº':'í• ì•„ë²„ì§€','å¥¶å¥¶':'í• ë¨¸ë‹ˆ',
'å¤–å…¬':'ì™¸í• ì•„ë²„ì§€','å¤–å©†':'ì™¸í• ë¨¸ë‹ˆ','å…’å­':'ì•„ë“¤','å¥³å…’':'ë”¸',
'è€å…¬':'ë‚¨í¸','è€å©†':'ì•„ë‚´','å“¥å“¥':'ì˜¤ë¹ /í˜•','å¼Ÿå¼Ÿ':'ë‚¨ë™ìƒ',
'å§å§':'ì–¸ë‹ˆ/ëˆ„ë‚˜','å¦¹å¦¹':'ì—¬ë™ìƒ','ä¼¯çˆ¶':'í°ì•„ë²„ì§€','å”å”':'ì‚¼ì´Œ',
'å§‘å§‘':'ê³ ëª¨','èˆ…èˆ…':'ì™¸ì‚¼ì´Œ','é˜¿å§¨':'ì´ëª¨',
'ä¼¯æ¯':'í°ì–´ë¨¸ë‹ˆ','å¬¸å¬¸':'ìˆ™ëª¨','å§‘ä¸ˆ':'ê³ ëª¨ë¶€','èˆ…åª½':'ì™¸ìˆ™ëª¨','å§¨ä¸ˆ':'ì´ëª¨ë¶€',
'å ‚å“¥':'ì‚¬ì´Œí˜•/ì˜¤ë¹ ','å ‚å¼Ÿ':'ì‚¬ì´Œë™ìƒ','å ‚å§':'ì‚¬ì´Œì–¸ë‹ˆ/ëˆ„ë‚˜','å ‚å¦¹':'ì‚¬ì´Œì—¬ë™ìƒ',
'è¡¨å“¥':'ì™¸ì‚¬ì´Œí˜•/ì˜¤ë¹ ','è¡¨å¼Ÿ':'ì™¸ì‚¬ì´Œë™ìƒ','è¡¨å§':'ì™¸ì‚¬ì´Œì–¸ë‹ˆ/ëˆ„ë‚˜','è¡¨å¦¹':'ì™¸ì‚¬ì´Œì—¬ë™ìƒ',
'ä¾„å­':'ì¡°ì¹´','ä¾„å¥³':'ì¡°ì¹´ë”¸','å¤–ç”¥':'ì™¸ì¡°ì¹´','å¤–ç”¥å¥³':'ì™¸ì¡°ì¹´ë”¸',
'å­«å­':'ì†ì','å­«å¥³':'ì†ë…€','åª³å©¦':'ë©°ëŠë¦¬','å¥³å©¿':'ì‚¬ìœ„',
'å…¬å…¬':'ì‹œì•„ë²„ì§€','å©†å©†':'ì‹œì–´ë¨¸ë‹ˆ','å²³çˆ¶':'ì¥ì¸','å²³æ¯':'ì¥ëª¨',
'å«‚å«‚':'í˜•ìˆ˜/ì˜¬ì¼€','å¼Ÿåª³':'ì œìˆ˜ì”¨','å§å¤«':'í˜•ë¶€/ë§¤í˜•','å¦¹å¤«':'ë§¤ì œ',
'æ›¾ç¥–çˆ¶':'ì¦ì¡°í• ì•„ë²„ì§€','æ›¾ç¥–æ¯':'ì¦ì¡°í• ë¨¸ë‹ˆ',
'å¤–æ›¾ç¥–çˆ¶':'ì™¸ì¦ì¡°í• ì•„ë²„ì§€','å¤–æ›¾ç¥–æ¯':'ì™¸ì¦ì¡°í• ë¨¸ë‹ˆ',
'æ›¾å­«':'ì¦ì†ì','æ›¾å­«å¥³':'ì¦ì†ë…€','å¤–æ›¾å­«':'ì™¸ì¦ì†ì','å¤–æ›¾å­«å¥³':'ì™¸ì¦ì†ë…€',
'ä¼¯å…¬':'í°í• ì•„ë²„ì§€','å”å…¬':'ì‘ì€í• ì•„ë²„ì§€','å§‘å©†':'ëŒ€ê³ ëª¨',
'ä¼¯å©†':'í°í• ë¨¸ë‹ˆ','å¬¸å©†':'ì‘ì€í• ë¨¸ë‹ˆ','å§‘ä¸ˆå…¬':'ëŒ€ê³ ëª¨ë¶€',
'ä¾„å­«':'ì¢…ì†ì','ä¾„å­«å¥³':'ì¢…ì†ë…€','å¤–ç”¥å­«':'ì™¸ì¢…ì†ì','å¤–ç”¥å­«å¥³':'ì™¸ì¢…ì†ë…€',
'å¤§ä¼¯':'ì‹œìˆ™','å°å”':'ì‹œë™ìƒ','å§‘å­':'ì‹œëˆ„ì´','èˆ…å­':'ì²˜ë‚¨','å¤§å§¨å­':'ì²˜í˜•','å°å§¨å­':'ì²˜ì œ',
'å ‚ä¼¯':'ì‚¬ì´Œí°ì•„ë²„ì§€','å ‚å”':'ì‚¬ì´Œì‚¼ì´Œ','å ‚å§‘':'ì‚¬ì´Œê³ ëª¨',
'è¡¨ä¼¯':'ì™¸ì‚¬ì´Œí°ì•„ë²„ì§€','è¡¨å”':'ì™¸ì‚¬ì´Œì‚¼ì´Œ','è¡¨å§‘':'ì™¸ì‚¬ì´Œê³ ëª¨',
'å ‚ä¾„':'ì‚¬ì´Œì¡°ì¹´','å ‚ä¾„å¥³':'ì‚¬ì´Œì¡°ì¹´ë”¸','è¡¨ä¾„':'ì™¸ì‚¬ì´Œì¡°ì¹´','è¡¨ä¾„å¥³':'ì™¸ì‚¬ì´Œì¡°ì¹´ë”¸',
'å ‚ä¼¯æ¯':'ì‚¬ì´Œí°ì–´ë¨¸ë‹ˆ','å ‚å¬¸':'ì‚¬ì´Œìˆ™ëª¨','å ‚å§‘ä¸ˆ':'ì‚¬ì´Œê³ ëª¨ë¶€',
'è¡¨ä¼¯æ¯':'ì™¸ì‚¬ì´Œí°ì–´ë¨¸ë‹ˆ','è¡¨å¬¸':'ì™¸ì‚¬ì´Œìˆ™ëª¨','è¡¨å§‘ä¸ˆ':'ì™¸ì‚¬ì´Œê³ ëª¨ë¶€',
'å ‚å§å¤«':'ì‚¬ì´Œë§¤í˜•','å ‚å¦¹å¤«':'ì‚¬ì´Œë§¤ì œ','å ‚å«‚':'ì‚¬ì´Œí˜•ìˆ˜','å ‚å¼Ÿåª³':'ì‚¬ì´Œì œìˆ˜',
'è¡¨å§å¤«':'ì™¸ì‚¬ì´Œë§¤í˜•','è¡¨å¦¹å¤«':'ì™¸ì‚¬ì´Œë§¤ì œ','è¡¨å«‚':'ì™¸ì‚¬ì´Œí˜•ìˆ˜','è¡¨å¼Ÿåª³':'ì™¸ì‚¬ì´Œì œìˆ˜',
'è‡ªå·±':'ìì‹ ','ç„¡é—œä¿‚':'ë¬´ê´€ê³„','è¦ªæˆš':'ì¹œì²™',
'å”ä¼¯è¼©':'ì‚¼ì´Œë»˜','å§‘å§¨è¼©':'ê³ ëª¨/ì´ëª¨ë»˜','ä¾„è¼©':'ì¡°ì¹´ë»˜','ä¾„å¥³è¼©':'ì¡°ì¹´ë”¸ë»˜',
'ç¥–è¼©':'ì¡°ë¶€ëª¨ë»˜','å­«è¼©':'ì†ìë»˜','å¹³è¼©':'ê°™ì€ í•­ë ¬',
};
let twAudio=null;
function speak(rom){if(twAudio){twAudio.pause();twAudio=null}twAudio=new Audio('https://hapsing.ithuan.tw/bangtsam?taibun='+encodeURIComponent(rom));twAudio.play().catch(()=>{})}

const adj={},mm={};
D.forEach(m=>{adj[m.id]=[];mm[m.id]=m});
PC.forEach(([p,c])=>{adj[p].push({to:c,t:'c'});adj[c].push({to:p,t:'p'})});
SP.forEach(([a,b])=>{adj[a].push({to:b,t:'s'});adj[b].push({to:a,t:'s'})});

function bfs(a,b){
 if(a===b)return[];
 const q=[[a,[]]],v=new Set([a]);
 while(q.length){const[c,p]=q.shift();for(const e of adj[c]){if(v.has(e.to))continue;const np=[...p,{f:c,to:e.to,t:e.t}];if(e.to===b)return np;v.add(e.to);q.push([e.to,np])}}
 return null;
}
function ch(p){return p.map(s=>(s.t==='p'?'P':s.t==='c'?'C':'S')+mm[s.to].g).join('')}
function el(a,b){const aa=AGE[a]??SIB[a],bb=AGE[b]??SIB[b];if(aa!=null&&bb!=null)return aa<bb;const ya=mm[a]?.y,yb=mm[b]?.y;if(ya&&yb)return ya<yb;return aa!=null?aa<99:false}
function T(z,en,fr,ct){return{zh:z,en:en,fr:fr||'',ct:ct||''}}

function kin(a,b,noSp){
 if(a===b)return T('è‡ªå·±','Self','Soi-mÃªme','è‡ªå·±');
 const p=bfs(a,b);if(!p)return T('ç„¡é—œä¿‚','No relation','Aucun lien','å†‡é—œä¿‚');
 const c=ch(p),to=mm[b],fr=mm[a];
 const S={
  PM:['çˆ¸çˆ¸','Father','PÃ¨re','è€ç«‡/çˆ¸çˆ¸'],PF:['åª½åª½','Mother','MÃ¨re','è€æ¯/åª½å’ª'],
  CM:['å…’å­','Son','Fils','ä»”'],CF:['å¥³å…’','Daughter','Fille','å¥³'],
  SM:['è€å…¬','Husband','Mari','è€å…¬'],SF:['è€å©†','Wife','Femme','è€å©†'],
  PMPM:['çˆºçˆº','Grandfather','Grand-pÃ¨re paternel','é˜¿çˆº'],PMPF:['å¥¶å¥¶','Grandmother','Grand-mÃ¨re paternelle','å«²å«²'],
  PFPM:['å¤–å…¬','Grandfather(M)','Grand-pÃ¨re maternel','å…¬å…¬'],PFPF:['å¤–å©†','Grandmother(M)','Grand-mÃ¨re maternelle','å©†å©†'],
  CMCM:['å­«å­','Grandson','Petit-fils','å­«'],CMCF:['å­«å¥³','Granddaughter','Petite-fille','å­«å¥³'],
  CFCM:['å¤–å­«','Grandson(D)','Petit-fils(fille)','å¤–å­«'],CFCF:['å¤–å­«å¥³','Granddaughter(D)','Petite-fille(fille)','å¤–å­«å¥³'],
  CMSF:['åª³å©¦','Daughter-in-law','Belle-fille','æ–°æŠ±'],CFSM:['å¥³å©¿','Son-in-law','Gendre','å¥³å©¿'],
  SMPM:['å…¬å…¬','Father-in-law','Beau-pÃ¨re','è€çˆº'],SMPF:['å©†å©†','Mother-in-law','Belle-mÃ¨re','å¥¶å¥¶'],
  SFPM:['å²³çˆ¶','Father-in-law','Beau-pÃ¨re','å¤–çˆ¶'],SFPF:['å²³æ¯','Mother-in-law','Belle-mÃ¨re','å¤–æ¯'],
  PMPMPM:['æ›¾ç¥–çˆ¶','Great-Grandfather','ArriÃ¨re-grand-pÃ¨re','å¤ªå…¬'],PMPMPF:['æ›¾ç¥–æ¯','Great-Grandmother','ArriÃ¨re-grand-mÃ¨re','å¤ªå©†'],
  PMPFPM:['å¤–æ›¾ç¥–çˆ¶','Great-Grandfather(M)','ArriÃ¨re-grand-pÃ¨re(M)','å¤ªå…¬(å¤–)'],PMPFPF:['å¤–æ›¾ç¥–æ¯','Great-Grandmother(M)','ArriÃ¨re-grand-mÃ¨re(M)','å¤ªå©†(å¤–)'],
  CMCMCM:['æ›¾å­«','Great-Grandson','ArriÃ¨re-petit-fils','æ›¾å­«'],CMCMCF:['æ›¾å­«å¥³','Great-Granddaughter','ArriÃ¨re-petite-fille','æ›¾å­«å¥³'],
  CMCFCM:['å¤–æ›¾å­«','Great-Grandson(D)','ArriÃ¨re-petit-fils(D)','å¤–æ›¾å­«'],CMCFCF:['å¤–æ›¾å­«å¥³','Great-Granddaughter(D)','ArriÃ¨re-petite-fille(D)','å¤–æ›¾å­«å¥³'],
  CFCMCM:['å¤–æ›¾å­«','Great-Grandson(D)','ArriÃ¨re-petit-fils(D)','å¤–æ›¾å­«'],CFCMCF:['å¤–æ›¾å­«å¥³','Great-Granddaughter(D)','ArriÃ¨re-petite-fille(D)','å¤–æ›¾å­«å¥³'],
  CFCFCM:['å¤–æ›¾å­«','Great-Grandson(D)','ArriÃ¨re-petit-fils(D)','å¤–æ›¾å­«'],CFCFCF:['å¤–æ›¾å­«å¥³','Great-Granddaughter(D)','ArriÃ¨re-petite-fille(D)','å¤–æ›¾å­«å¥³'],
 };
 if(S[c])return T(S[c][0],S[c][1],S[c][2],S[c][3]);

 // siblings
 if(/^P[MF]C[MF]$/.test(c)){
  if(to.g==='M')return el(b,a)?T('å“¥å“¥','Elder Brother','FrÃ¨re aÃ®nÃ©','å¤§ä½¬/é˜¿å“¥'):T('å¼Ÿå¼Ÿ','Younger Brother','Petit frÃ¨re','ç´°ä½¬');
  return el(b,a)?T('å§å§','Elder Sister','Grande sÅ“ur','å®¶å§'):T('å¦¹å¦¹','Younger Sister','Petite sÅ“ur','ç´°å¦¹');
 }
 // uncle/aunt
 if(/^P[MF]P[MF]C[MF]$/.test(c)){
  const pat=c[1]==='M';
  if(pat){if(to.g==='M')return el(b,p[0].to)?T('ä¼¯çˆ¶','Uncle(Elder)','Oncle paternel aÃ®nÃ©','ä¼¯çˆ¶'):T('å”å”','Uncle(Younger)','Oncle paternel cadet','å”å”');return T('å§‘å§‘','Paternal Aunt','Tante paternelle','å§‘åª½');}
  return to.g==='M'?T('èˆ…èˆ…','Maternal Uncle','Oncle maternel','èˆ…çˆ¶'):T('é˜¿å§¨','Maternal Aunt','Tante maternelle','é˜¿å§¨');
 }
 // uncle/aunt's spouse
 if(/^P[MF]P[MF]C[MF]S[MF]$/.test(c)){
  const pat=c[1]==='M',sib=mm[p[2].to];
  if(pat){if(sib.g==='M')return el(sib.id,p[0].to)?T('ä¼¯æ¯','Uncle\'s Wife(E)','Tante(oncle aÃ®nÃ©)','ä¼¯å¨˜'):T('å¬¸å¬¸','Uncle\'s Wife(Y)','Tante(oncle cadet)','å¬¸å¬¸');return T('å§‘ä¸ˆ','Aunt\'s Husband','Oncle(mari tante)','å§‘ä¸ˆ');}
  return sib.g==='M'?T('èˆ…åª½','Uncle\'s Wife(M)','Tante(oncle M)','èˆ…æ¯'):T('å§¨ä¸ˆ','Aunt\'s Husband(M)','Oncle(mari tante M)','å§¨ä¸ˆ');
 }
 // cousins
 if(/^P[MF]P[MF]C[MF]C[MF]$/.test(c)){
  const pat=c[1]==='M',mid=mm[p[2].to],tang=pat&&mid.g==='M',e=el(b,a),pf=tang?'å ‚':'è¡¨';
  if(to.g==='M')return e?T(pf+'å“¥','Cousin(M,E)','Cousin aÃ®nÃ©',pf+'å¤§ä½¬'):T(pf+'å¼Ÿ','Cousin(M,Y)','Cousin cadet',pf+'ç´°ä½¬');
  return e?T(pf+'å§','Cousin(F,E)','Cousine aÃ®nÃ©e',pf+'å®¶å§'):T(pf+'å¦¹','Cousin(F,Y)','Cousine cadette',pf+'ç´°å¦¹');
 }
 // nephew/niece
 if(/^P[MF]C[MF]C[MF]$/.test(c)){
  const sib=mm[p[1].to];
  if(sib.g==='M')return to.g==='M'?T('ä¾„å­','Nephew(B)','Neveu','ä¾„ä»”'):T('ä¾„å¥³','Niece(B)','NiÃ¨ce','ä¾„å¥³');
  return to.g==='M'?T('å¤–ç”¥','Nephew(S)','Neveu(sÅ“ur)','å¤–ç”¥'):T('å¤–ç”¥å¥³','Niece(S)','NiÃ¨ce(sÅ“ur)','å¤–ç”¥å¥³');
 }
 // sibling's spouse
 if(/^P[MF]C[MF]S[MF]$/.test(c)){
  const sib=mm[p[1].to],e=el(sib.id,a);
  if(sib.g==='M')return e?T('å«‚å«‚','Elder Bro\'s Wife','Belle-sÅ“ur(frÃ¨re aÃ®nÃ©)','é˜¿å«‚'):T('å¼Ÿåª³','Younger Bro\'s Wife','Belle-sÅ“ur(frÃ¨re cadet)','å¼Ÿå©¦');
  return e?T('å§å¤«','Elder Sis\'s Husband','Beau-frÃ¨re(sÅ“ur aÃ®nÃ©e)','å§å¤«'):T('å¦¹å¤«','Younger Sis\'s Husband','Beau-frÃ¨re(sÅ“ur cadette)','å¦¹å¤«');
 }
 // spouse's sibling
 if(/^S[MF]P[MF]C[MF]$/.test(c)){
  const sp=mm[p[0].to];
  if(sp.g==='M'){return to.g==='M'?(el(b,sp.id)?T('å¤§ä¼¯','H\'s Elder Bro','Beau-frÃ¨re aÃ®nÃ©','å¤§ä¼¯'):T('å°å”','H\'s Younger Bro','Beau-frÃ¨re cadet','å”ä»”')):T('å§‘å­','H\'s Sister','Belle-sÅ“ur','å§‘å¥¶');}
  return to.g==='M'?T('èˆ…å­','W\'s Brother','Beau-frÃ¨re','èˆ…ä»”'):(el(b,sp.id)?T('å¤§å§¨å­','W\'s Elder Sis','Belle-sÅ“ur aÃ®nÃ©e','å¤§å§¨'):T('å°å§¨å­','W\'s Younger Sis','Belle-sÅ“ur cadette','ç´°å§¨'));
 }

 // === Gen3 â†” Gen1 ===
 if(/^P[MF]P[MF]P[MF]C[MF]$/.test(c)){
  const anc=p[1].to;
  if(to.g==='M')return el(b,anc)?T('ä¼¯å…¬','Grand-Uncle(E)','Grand-oncle aÃ®nÃ©','ä¼¯å…¬'):T('å”å…¬','Grand-Uncle(Y)','Grand-oncle cadet','å”å…¬');
  return T('å§‘å©†','Grand-Aunt','Grand-tante','å§‘å©†');
 }
 if(/^P[MF]P[MF]P[MF]C[MF]S[MF]$/.test(c)){
  const sib=mm[p[3].to],anc=p[1].to;
  if(sib.g==='M')return el(sib.id,anc)?T('ä¼¯å©†','Grand-Uncle\'s Wife(E)','Gd-tante(oncle aÃ®nÃ©)','ä¼¯å©†'):T('å¬¸å©†','Grand-Uncle\'s Wife(Y)','Gd-tante(oncle cadet)','å¬¸å©†');
  return T('å§‘ä¸ˆå…¬','Grand-Aunt\'s Husband','Grand-oncle(mari)','å§‘ä¸ˆå…¬');
 }
 if(/^P[MF]C[MF]C[MF]C[MF]$/.test(c)){
  const sib=mm[p[1].to];
  if(sib.g==='M')return to.g==='M'?T('ä¾„å­«','Grand-Nephew(B)','Petit-neveu','ä¾„å­«'):T('ä¾„å­«å¥³','Grand-Niece(B)','Petite-niÃ¨ce','ä¾„å­«å¥³');
  return to.g==='M'?T('å¤–ç”¥å­«','Grand-Nephew(S)','Petit-neveu(S)','å¤–ç”¥å­«'):T('å¤–ç”¥å­«å¥³','Grand-Niece(S)','Petite-niÃ¨ce(S)','å¤–ç”¥å­«å¥³');
 }

 // === Gen3 â†” Gen2 cross-branch ===
 if(/^P[MF]P[MF]P[MF]C[MF]C[MF]$/.test(c)){
  const gen1=mm[p[3].to],pf=gen1.g==='M'?'å ‚':'è¡¨',anc=p[0].to;
  if(to.g==='M')return el(b,anc)?T(pf+'ä¼¯',pf+'-Uncle(E)',pf==='å ‚'?'Cousin-oncle aÃ®nÃ©':'Cousin-oncle aÃ®nÃ©(M)',pf+'ä¼¯'):T(pf+'å”',pf+'-Uncle(Y)',pf==='å ‚'?'Cousin-oncle cadet':'Cousin-oncle cadet(M)',pf+'å”');
  return T(pf+'å§‘',pf+'-Aunt',pf==='å ‚'?'Cousine-tante':'Cousine-tante(M)',pf+'å§‘');
 }
 if(/^P[MF]P[MF]P[MF]C[MF]C[MF]S[MF]$/.test(c)){
  const gen1=mm[p[3].to],gen2=mm[p[4].to],pf=gen1.g==='M'?'å ‚':'è¡¨',anc=p[0].to;
  if(gen2.g==='M')return el(gen2.id,anc)?T(pf+'ä¼¯æ¯',pf+'-Uncle\'s Wife(E)','Tante(cousin-oncle)',pf+'ä¼¯å¨˜'):T(pf+'å¬¸',pf+'-Uncle\'s Wife(Y)','Tante(cousin-oncle)',pf+'å¬¸');
  return T(pf+'å§‘ä¸ˆ',pf+'-Aunt\'s Husband','Oncle(cousine-tante)',pf+'å§‘ä¸ˆ');
 }
 if(/^P[MF]P[MF]C[MF]C[MF]C[MF]$/.test(c)){
  const gen1=mm[p[0].to],pf=gen1.g==='M'?'å ‚':'è¡¨';
  return to.g==='M'?T(pf+'ä¾„',pf+'-Nephew','Cousin-neveu',pf+'ä¾„'):T(pf+'ä¾„å¥³',pf+'-Niece','Cousine-niÃ¨ce',pf+'ä¾„å¥³');
 }
 // Gen3 â†” Gen3 cross-branch (through Gen0)
 if(/^P[MF]P[MF]P[MF]C[MF]C[MF]C[MF]$/.test(c)){
  const gen1=mm[p[3].to],pf=gen1.g==='M'?'å ‚':'è¡¨',e=el(b,a);
  if(to.g==='M')return e?T(pf+'å“¥','Cousin(M,E)','Cousin aÃ®nÃ©',pf+'å¤§ä½¬'):T(pf+'å¼Ÿ','Cousin(M,Y)','Cousin cadet',pf+'ç´°ä½¬');
  return e?T(pf+'å§','Cousin(F,E)','Cousine aÃ®nÃ©e',pf+'å®¶å§'):T(pf+'å¦¹','Cousin(F,Y)','Cousine cadette',pf+'ç´°å¦¹');
 }
 // cousin's spouse
 if(/^P[MF]P[MF]C[MF]C[MF]S[MF]$/.test(c)){
  const mid2=mm[p[2].to],tang=c[1]==='M'&&mid2.g==='M',pf=tang?'å ‚':'è¡¨',cuz=mm[p[3].to];
  if(cuz.g==='F')return el(cuz.id,a)?T(pf+'å§å¤«','Cousin\'s H(E)','Beau-cousin',pf+'å§å¤«'):T(pf+'å¦¹å¤«','Cousin\'s H(Y)','Beau-cousin',pf+'å¦¹å¤«');
  return el(cuz.id,a)?T(pf+'å«‚','Cousin\'s W(E)','Belle-cousine',pf+'å«‚'):T(pf+'å¼Ÿåª³','Cousin\'s W(Y)','Belle-cousine',pf+'å¼Ÿå©¦');
 }
 // in-law sibling's children
 if(/^S[MF]P[MF]C[MF]C[MF]$/.test(c)){
  const sib=mm[p[2].to];
  if(sib.g==='M')return to.g==='M'?T('ä¾„å­','Nephew','Neveu','ä¾„ä»”'):T('ä¾„å¥³','Niece','NiÃ¨ce','ä¾„å¥³');
  return to.g==='M'?T('å¤–ç”¥','Nephew','Neveu','å¤–ç”¥'):T('å¤–ç”¥å¥³','Niece','NiÃ¨ce','å¤–ç”¥å¥³');
 }
 if(/^S[MF]C[MF]$/.test(c))return to.g==='M'?T('å…’å­','Son','Fils','ä»”'):T('å¥³å…’','Daughter','Fille','å¥³');
 if(/^S[MF]C[MF]C[MF]$/.test(c))return to.g==='M'?T('å­«å­','Grandson','Petit-fils','å­«'):T('å­«å¥³','Granddaughter','Petite-fille','å­«å¥³');
 if(/^C[MF]S[MF]$/.test(c))return to.g==='M'?T('å¥³å©¿','Son-in-law','Gendre','å¥³å©¿'):T('åª³å©¦','Daughter-in-law','Belle-fille','æ–°æŠ±');

 // spouse delegation
 if(/^S[MF]/.test(c)&&c.length>=4&&!noSp){
  const r=kin(p[0].to,b,true);
  if(r.zh!=='è¦ªæˆš')return r;
 }

 // generation fallback
 const gd=to.gen-fr.gen;
 if(gd===-1)return to.g==='M'?T('å”ä¼¯è¼©','Elder(Uncle gen)','Oncle(gÃ©n.)','å”ä¼¯è¼©'):T('å§‘å§¨è¼©','Elder(Aunt gen)','Tante(gÃ©n.)','å§‘å§¨è¼©');
 if(gd===1)return to.g==='M'?T('ä¾„è¼©','Junior(Nephew gen)','Neveu(gÃ©n.)','ä¾„è¼©'):T('ä¾„å¥³è¼©','Junior(Niece gen)','NiÃ¨ce(gÃ©n.)','ä¾„å¥³è¼©');
 if(gd===-2)return T('ç¥–è¼©','Grandparent gen','Grands-parents(gÃ©n.)','ç¥–è¼©');
 if(gd===2)return T('å­«è¼©','Grandchild gen','Petits-enfants(gÃ©n.)','å­«è¼©');
 if(gd===0)return T('å¹³è¼©','Same generation','MÃªme gÃ©nÃ©ration','å¹³è¼©');
 return T('è¦ªæˆš','Relative','Parent','è¦ªæˆš');
}

const branches=[
 {g1:['fa','mo'],subs:[{p:'ego',sp:'csh',k:['wjy','cpy']},{p:'wyx2',sp:null,k:[]}]},
 {g1:['dagu','daguh'],subs:[{p:'psw',sp:'psww',k:[]},{p:'psk',sp:'pskw',k:['pk1','pk2']}]},
 {g1:['ersh','ershw'],subs:[{p:'wzc',sp:'wxw',k:['wmz','wmy','wts']},{p:'wyx',sp:'jay',k:['cc']},{p:'wyw',sp:'michael',k:['bd','le']},{p:'wyh',sp:'nick',k:['mila']}]},
 {g1:['sansh','sanshw'],subs:[{p:'wyj',sp:'antoine',k:['ali']},{p:'wzg',sp:'winnie',k:['sz','mochi']}]},
 {g1:['xgu','xguh'],subs:[{p:'lya',sp:'polly',k:[]},{p:'ljy',sp:null,k:[]}]},
 {g1:['xsh','xshw'],subs:[{p:'wyq',sp:null,k:[]},{p:'wzh',sp:'lmd',k:['mnt']}]},
];

function zodiac(y){const z=['ğŸµçŒ´','ğŸ”é›','ğŸ¶ç‹—','ğŸ·è±¬','ğŸ­é¼ ','ğŸ®ç‰›','ğŸ¯è™','ğŸ°å…”','ğŸ‰é¾','ğŸè›‡','ğŸ´é¦¬','ğŸ‘ç¾Š'];return z[y%12]}
function mkP(m,cls){
 const d=document.createElement('div');d.className='p'+(cls?' '+cls:'')+(m.d?' dead':'');d.dataset.id=m.id;
 const zd=m.y?'<div class="zd">'+zodiac(m.y)+'</div>':'';
 d.innerHTML=`<div class="a ${m.g==='M'?'m':'f'}">${m.g==='M'?'ğŸ‘¨':'ğŸ‘©'}</div><div class="n">${m.n}</div>${m.e?'<div class="en">'+m.e+'</div>':''}${zd}`;
 d.onclick=()=>click(m.id);return d;
}

function render(){
 const r0=document.getElementById('g0'),c0=document.createElement('div');c0.className='cp';
 c0.appendChild(mkP(mm.gf));c0.appendChild(mkP(mm.gm));r0.appendChild(c0);
 const r1=document.getElementById('g12');
 branches.forEach(br=>{
  const col=document.createElement('div');col.className='branch';
  const cp=document.createElement('div');cp.className='cp';
  cp.appendChild(mkP(mm[br.g1[0]]));cp.appendChild(mkP(mm[br.g1[1]]));
  col.appendChild(cp);
  const sf=document.createElement('div');sf.className='subfams';
  br.subs.forEach(sub=>{
   const f=document.createElement('div');f.className='subfam';
   const sc=document.createElement('div');sc.className='cp';
   sc.appendChild(mkP(mm[sub.p]));
   if(sub.sp)sc.appendChild(mkP(mm[sub.sp]));
   f.appendChild(sc);
   if(sub.k.length){
    const kd=document.createElement('div');kd.className='kids';
    sub.k.forEach(kid=>kd.appendChild(mkP(mm[kid],'g3')));
    f.appendChild(kd);
   }
   sf.appendChild(f);
  });
  col.appendChild(sf);
  r1.appendChild(col);
 });
 requestAnimationFrame(drawLines);
}

function ctr(id){const e=document.querySelector(`[data-id="${id}"] .a`);if(!e)return null;const s=document.getElementById('L').getBoundingClientRect(),r=e.getBoundingClientRect();return{x:r.left+r.width/2-s.left,y:r.top+r.height/2-s.top}}
function mid(a,b){const p=ctr(a),q=ctr(b);return p&&q?{x:(p.x+q.x)/2,y:(p.y+q.y)/2}:null}

function drawLines(){
 const svg=document.getElementById('L'),tree=document.getElementById('tree');
 svg.setAttribute('width',tree.scrollWidth);svg.setAttribute('height',tree.scrollHeight);svg.innerHTML='';
 SP.forEach(([a,b])=>{const p=ctr(a),q=ctr(b);if(!p||!q)return;const l=document.createElementNS('http://www.w3.org/2000/svg','line');l.setAttribute('x1',p.x);l.setAttribute('y1',p.y);l.setAttribute('x2',q.x);l.setAttribute('y2',q.y);svg.appendChild(l)});
 const gp=mid('gf','gm');
 if(gp)branches.forEach(br=>{
  const cp=mid(br.g1[0],br.g1[1]);if(!cp)return;
  const my=(gp.y+24+cp.y-24)/2;
  const d=document.createElementNS('http://www.w3.org/2000/svg','path');
  d.setAttribute('d',`M${gp.x},${gp.y+24}L${gp.x},${my}L${cp.x},${my}L${cp.x},${cp.y-24}`);svg.appendChild(d);
 });
 branches.forEach(br=>{
  const cp1=mid(br.g1[0],br.g1[1]);if(!cp1)return;
  br.subs.forEach(sub=>{
   const pt=sub.sp?mid(sub.p,sub.sp):ctr(sub.p);if(!pt)return;
   const my=(cp1.y+24+pt.y-24)/2;
   const d=document.createElementNS('http://www.w3.org/2000/svg','path');
   d.setAttribute('d',`M${cp1.x},${cp1.y+24}L${cp1.x},${my}L${pt.x},${my}L${pt.x},${pt.y-24}`);svg.appendChild(d);
   sub.k.forEach(kid=>{
    const kp=ctr(kid);if(!kp)return;
    const my2=(pt.y+24+kp.y-24)/2;
    const d2=document.createElementNS('http://www.w3.org/2000/svg','path');
    d2.setAttribute('d',`M${pt.x},${pt.y+24}L${pt.x},${my2}L${kp.x},${my2}L${kp.x},${kp.y-18}`);svg.appendChild(d2);
   });
  });
 });
}

let sA=null,sB=null;
function click(id){
 if(!sA){sA=id;hi();showSbar(`å·²é¸ <span class="badge ba">A</span> <b>${mm[id].n}</b>ï¼Œè«‹é»é¸ B`);}
 else if(!sB&&id!==sA){sB=id;hi();showModal();}
 else{sA=id;sB=null;hi();showSbar(`å·²é¸ <span class="badge ba">A</span> <b>${mm[id].n}</b>ï¼Œè«‹é»é¸ B`);}
 document.getElementById('btn').style.display='block';
}
function hi(){
 document.querySelectorAll('.p').forEach(e=>{e.classList.remove('sa','sb');e.querySelector('.badge')?.remove()});
 if(sA){const e=document.querySelector(`[data-id="${sA}"]`);e.classList.add('sa');e.insertAdjacentHTML('beforeend','<span class="badge ba">A</span>')}
 if(sB){const e=document.querySelector(`[data-id="${sB}"]`);e.classList.add('sb');e.insertAdjacentHTML('beforeend','<span class="badge bb">B</span>')}
}
function showSbar(h){const b=document.getElementById('sbar');b.style.display='block';b.innerHTML=h}
function showModal(){
 const k=kin(sA,sB);
 const an=mm[sA].n+(mm[sA].e?' ('+mm[sA].e+')':'');
 const bn=mm[sB].n+(mm[sB].e?' ('+mm[sB].e+')':'');
 const tw=TW[k.zh];
 const twHtml=tw?`<div class="tw-box"><div><div class="tw-term">${tw[0]}</div><div class="tw-rom">${tw[1]}</div></div><button class="play-btn" onclick="speak('${tw[1]}')">ğŸ”Š</button></div>`:`<div class="tw-box"><div class="tw-term" style="font-size:14px;color:#999">å°èªè³‡æ–™å¾…è£œ</div></div>`;
 document.getElementById('mdl').innerHTML=`
  <div class="who"><span class="badge ba">A</span> <b>${an}</b> å« <span class="badge bb">B</span> <b>${bn}</b></div>
  <div class="main-term">${k.zh}</div>
  ${twHtml}
  <div class="lang-row">
   <div class="lang"><div class="label">English</div><div class="val">${k.en}</div></div>
   <div class="lang"><div class="label">FranÃ§ais</div><div class="val">${k.fr}</div></div>
   <div class="lang"><div class="label">ç²µèª</div><div class="val">${k.ct}</div></div>
   <div class="lang"><div class="label">í•œêµ­ì–´</div><div class="val">${KR[k.zh]||'-'}</div></div>
  </div>
  <button class="close-btn" onclick="closeM()">é—œé–‰</button>`;
 document.getElementById('mbg').classList.add('show');
 document.getElementById('sbar').style.display='none';
 if(tw)setTimeout(()=>speak(tw[1]),300);
}
function closeM(e){if(!e||e.target===document.getElementById('mbg')){document.getElementById('mbg').classList.remove('show');if(twAudio){twAudio.pause();twAudio=null}}}
function reset(){sA=sB=null;hi();document.getElementById('sbar').style.display='none';document.getElementById('btn').style.display='none';document.getElementById('mbg').classList.remove('show')}

window.onload=()=>{render();window.onresize=drawLines};
</script>
</body>
</html>