<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0">
<title>Âê≥ÂÆ∂ÂÆ∂ÊóèÁ®±Ë¨ÇÊü•Ë©¢</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Microsoft JhengHei','PingFang TC',sans-serif;background:#f0f4f8;min-height:100vh}
header{background:linear-gradient(135deg,#2c3e50,#3498db);color:#fff;text-align:center;padding:16px;position:sticky;top:0;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,.2)}
header h1{font-size:20px;margin-bottom:3px}
#inst{font-size:12px;opacity:.9}
#wrap{overflow-x:auto;overflow-y:visible;padding:20px 10px 50px;-webkit-overflow-scrolling:touch}
#tree{position:relative;display:inline-block;min-width:100%}
svg#L{position:absolute;top:0;left:0;pointer-events:none;z-index:1}
svg#L path{fill:none;stroke:#bbb;stroke-width:1.5}
svg#L line{stroke:#e74c3c;stroke-width:1.5;stroke-dasharray:5,3}
.row{display:flex;justify-content:center;align-items:flex-start;gap:10px;position:relative;z-index:2;margin-bottom:10px}
.row.r0{margin-bottom:30px}
.branch{display:flex;flex-direction:column;align-items:center;border:1px solid #dee2e6;border-radius:10px;padding:8px 6px;background:#fff;gap:4px}
.cp{display:flex;gap:4px;align-items:flex-start}
.subfams{display:flex;gap:6px;align-items:flex-start;flex-wrap:wrap;justify-content:center}
.subfam{display:flex;flex-direction:column;align-items:center;gap:3px;border:1px solid #e0e0e0;border-radius:8px;padding:5px 4px;background:#fafbfc}
.kids{display:flex;flex-direction:column;align-items:center;gap:2px}
.p{width:58px;text-align:center;cursor:pointer;transition:transform .1s;position:relative;z-index:2}
.p:hover{transform:scale(1.08)}
.p.sa .a{box-shadow:0 0 0 3px #0d6efd,0 0 10px rgba(13,110,253,.4)}
.p.sb .a{box-shadow:0 0 0 3px #dc3545,0 0 10px rgba(220,53,69,.4)}
.a{width:42px;height:42px;border-radius:50%;margin:0 auto 2px;display:flex;align-items:center;justify-content:center;font-size:16px;border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.12);transition:box-shadow .1s}
.a.m{background:linear-gradient(135deg,#74b9ff,#0984e3)}
.a.f{background:linear-gradient(135deg,#fd79a8,#e84393)}
.p.dead .a{opacity:.4;filter:grayscale(1)}
.p.dead .n{color:#aaa}
.p.dead::after{content:'‚úù';position:absolute;top:-2px;right:2px;font-size:10px;color:#999}
.n{font-size:10px;font-weight:600;color:#2d3436;line-height:1.2;white-space:nowrap}
.en{font-size:8px;color:#6c757d;line-height:1;white-space:nowrap}
.g3 .a{width:34px;height:34px;font-size:13px}
.g3 .n{font-size:9px}
.g3 .en{font-size:7px}
.g3{width:48px}
.badge{display:inline-block;padding:0 4px;border-radius:6px;font-size:8px;font-weight:bold;color:#fff;margin-top:1px}
.ba{background:#0d6efd}.bb{background:#dc3545}
#btn{position:fixed;bottom:14px;right:14px;background:#6c757d;color:#fff;border:none;padding:7px 16px;border-radius:18px;cursor:pointer;font-size:12px;box-shadow:0 2px 6px rgba(0,0,0,.2);display:none;z-index:200}
footer{text-align:center;padding:12px;color:#aaa;font-size:10px}
/* Modal */
.modal-bg{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.45);z-index:300;align-items:center;justify-content:center}
.modal-bg.show{display:flex}
.modal{background:#fff;border-radius:16px;padding:24px 20px;max-width:340px;width:90%;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,.3);animation:popIn .2s ease}
@keyframes popIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
.modal .who{font-size:13px;color:#555;margin-bottom:12px}
.modal .who b{color:#2d3436}
.modal .main-term{font-size:36px;font-weight:bold;color:#d63384;margin:8px 0}
.modal .lang-row{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin-top:10px}
.modal .lang{background:#f8f9fa;border-radius:8px;padding:6px 12px;min-width:70px}
.modal .lang .label{font-size:9px;color:#999;text-transform:uppercase}
.modal .lang .val{font-size:14px;font-weight:600;color:#2d3436}
.modal .close-btn{margin-top:16px;background:#6c757d;color:#fff;border:none;padding:8px 28px;border-radius:20px;font-size:13px;cursor:pointer}
/* Status bar for A selection */
#sbar{background:#e3f2fd;color:#1565c0;padding:8px 16px;text-align:center;font-size:14px;font-weight:bold;display:none;border-bottom:2px solid #42a5f5;position:sticky;top:55px;z-index:99}
</style>
</head>
<body>
<header>
<h1>Âê≥ÂÆ∂Âõõ‰ª£ÂÆ∂ÊóèÈóú‰øÇÂúñ ‚Äî Á®±Ë¨ÇÊü•Ë©¢</h1>
<div id="inst">ÈªûÈÅ∏ A ÂÜçÈªûÈÅ∏ B ‚Üí È°ØÁ§∫Á®±Ë¨ÇÔºà‰∏≠ÔºèËã±ÔºèÊ≥ïÔºèÁ≤µÔºâ</div>
</header>
<div id="sbar"></div>
<div id="wrap"><div id="tree"><svg id="L"></svg><div id="g0" class="row r0"></div><div id="g12" class="row"></div></div></div>
<button id="btn" onclick="reset()">Ê∏ÖÈô§</button>
<div class="modal-bg" id="mbg" onclick="closeM(event)"><div class="modal" id="mdl"></div></div>
<footer>Âê≥ÂÆ∂Âõõ‰ª£ÂÆ∂ÊóèÁ®±Ë¨ÇÊü•Ë©¢Á≥ªÁµ±</footer>
<script>
const D=[
{id:'gf',n:'Âê≥Êú®Êûó',g:'M',gen:0,d:1},{id:'gm',n:'Âê≥Ë≥¥Â™õ',g:'F',gen:0,d:1},
{id:'fa',n:'Âê≥‰ªÅÊù∞',g:'M',gen:1,d:1},{id:'mo',n:'È≠èÈ∫óÁúü',g:'F',gen:1},
{id:'dagu',n:'Âê≥È∫óÈõ≤',g:'F',gen:1,d:1},{id:'daguh',n:'ÂΩ≠ÊñóÈäò',g:'M',gen:1},
{id:'ersh',n:'Âê≥‰ªÅÁëû',g:'M',gen:1},{id:'ershw',n:'ÊûóÂ¶ÇËä≥',g:'F',gen:1},
{id:'sansh',n:'Âê≥‰ªÅÂòâ',g:'M',gen:1},{id:'sanshw',n:'ÁéãÊ°ÇÁöá',g:'F',gen:1},
{id:'xgu',n:'Âê≥È∫óÊòé',g:'F',gen:1,d:1},{id:'xguh',n:'ÊùéÈå´Èäò',g:'M',gen:1,d:1},
{id:'xsh',n:'Âê≥‰ªÅÂíå',g:'M',gen:1},{id:'xshw',n:'ÊõæÊõºÈ∫ó',g:'F',gen:1},
{id:'ego',n:'Âê≥ÂüπÂΩ∞',e:'Marc',g:'M',gen:2},{id:'csh',n:'Èô≥ÊÄùÊ®∫',e:'Chloe',g:'F',gen:2},
{id:'wyx2',n:'Âê≥ÊÄ°Ëê±',e:'Kama',g:'F',gen:2},
{id:'psw',n:'ÂΩ≠ÊùæÊñá',e:'Kevin',g:'M',gen:2},{id:'psww',n:'ÊùæÊñáÂ´Ç',g:'F',gen:2},
{id:'psk',n:'ÂΩ≠ÊùæÂ¥ë',g:'M',gen:2},{id:'pskw',n:'ÊùæÂ¥ëÂ´Ç',g:'F',gen:2},
{id:'wzc',n:'Âê≥Ê≠£Ê∑≥',e:'George',g:'M',gen:2},{id:'wxw',n:'Âê≥ÊõâËë≥',g:'F',gen:2},
{id:'wyx',n:'Âê≥ÊÄ°Ê¨£',e:'Elsa',g:'F',gen:2},{id:'jay',n:'Jay',g:'M',gen:2},
{id:'wyw',n:'Âê≥ÊÄ°Áéü',e:'Elva',g:'F',gen:2},{id:'michael',n:'Anthony',g:'M',gen:2},
{id:'wyh',n:'Âê≥ÊÄ°Ëôπ',e:'Eve',g:'F',gen:2},{id:'nick',n:'Peter',g:'M',gen:2},
{id:'wyj',n:'Âê≥ÊÄ°ÊΩî',e:'Lisa',g:'F',gen:2},{id:'antoine',n:'Antoine',g:'M',gen:2},
{id:'wzg',n:'Âê≥ÂÆóÂâõ',e:'Tim',g:'M',gen:2},{id:'winnie',n:'Winnie',g:'F',gen:2},
{id:'lya',n:'ÊùéÊõúÂÆâ',e:'Jethero',g:'M',gen:2},{id:'polly',n:'Polly',g:'F',gen:2},
{id:'ljy',n:'ÊùéÂÅ•ÊØì',e:'Billy',g:'M',gen:2},
{id:'wyq',n:'Âê≥ÊÄ°Â•á',e:'Whithney',g:'F',gen:2},
{id:'wzh',n:'Âê≥Ê≠£Áöì',g:'M',gen:2},{id:'lmd',n:'ÂäâÊõºËíÇ',g:'F',gen:2},
{id:'wjy',n:'Âê≥ÂÅ•ÂÆá',e:'Tiger',g:'M',gen:3},{id:'cpy',n:'Èô≥ÂìÅË´∫',e:'Leo',g:'M',gen:3},
{id:'pk1',n:'ÂΩ≠Â§ßÂØ∂',g:'M',gen:3},{id:'pk2',n:'ÂΩ≠‰∫åÂØ∂',g:'M',gen:3},
{id:'wmz',n:'Âê≥ÊòéÂì≤',e:'Roger',g:'M',gen:3},{id:'wmy',n:'Âê≥Êòé‰Ωë',g:'M',gen:3},{id:'wts',n:'Âê≥‰∫≠Ëê±',g:'F',gen:3},
{id:'cc',n:'CC',g:'M',gen:3},{id:'mila',n:'Mila',g:'F',gen:3},
{id:'bd',n:'Â∞è‰æøÁï∂',g:'F',gen:3},{id:'le',n:'Â∞èÊª∑Ëõã',g:'M',gen:3},
{id:'ali',n:'Ali',g:'F',gen:3},
{id:'sz',n:'ËñØ‰ªî',g:'M',gen:3},{id:'mochi',n:'È∫ªÁ≥¨',g:'M',gen:3},
{id:'mnt',n:'Ëø∑‰Ω†ÂÖî',g:'F',gen:3},
];
const SP=[['gf','gm'],['fa','mo'],['dagu','daguh'],['ersh','ershw'],['sansh','sanshw'],['xgu','xguh'],['xsh','xshw'],
 ['ego','csh'],['psw','psww'],['psk','pskw'],['wzc','wxw'],['wyx','jay'],['wyw','michael'],['wyh','nick'],
 ['wyj','antoine'],['wzg','winnie'],['lya','polly'],['wzh','lmd']];
const PC=[
 ['gf','fa'],['gm','fa'],['gf','dagu'],['gm','dagu'],['gf','ersh'],['gm','ersh'],
 ['gf','sansh'],['gm','sansh'],['gf','xgu'],['gm','xgu'],['gf','xsh'],['gm','xsh'],
 ['fa','ego'],['mo','ego'],['fa','wyx2'],['mo','wyx2'],
 ['dagu','psw'],['daguh','psw'],['dagu','psk'],['daguh','psk'],
 ['ersh','wzc'],['ershw','wzc'],['ersh','wyx'],['ershw','wyx'],['ersh','wyw'],['ershw','wyw'],['ersh','wyh'],['ershw','wyh'],
 ['sansh','wyj'],['sanshw','wyj'],['sansh','wzg'],['sanshw','wzg'],
 ['xgu','lya'],['xguh','lya'],['xgu','ljy'],['xguh','ljy'],
 ['xsh','wyq'],['xshw','wyq'],['xsh','wzh'],['xshw','wzh'],
 ['ego','wjy'],['csh','wjy'],['ego','cpy'],['csh','cpy'],
 ['psk','pk1'],['pskw','pk1'],['psk','pk2'],['pskw','pk2'],
 ['wzc','wmz'],['wxw','wmz'],['wzc','wmy'],['wxw','wmy'],['wzc','wts'],['wxw','wts'],
 ['wyx','cc'],['jay','cc'],['wyw','mila'],['michael','mila'],
 ['wyh','bd'],['nick','bd'],['wyh','le'],['nick','le'],
 ['wyj','ali'],['antoine','ali'],
 ['wzg','sz'],['winnie','sz'],['wzg','mochi'],['winnie','mochi'],
 ['wzh','mnt'],['lmd','mnt'],
];
const SIB={fa:1,dagu:2,ersh:3,sansh:4,xgu:5,xsh:6};
const AGE={ego:1,wyx2:2,psw:3,psk:4,wzc:5,wyx:6,wyw:7,wyh:8,wyj:9,wzg:10,lya:11,ljy:12,wyq:13,wzh:14,
 csh:1,psww:3,pskw:4,wxw:5,jay:6,michael:7,nick:8,antoine:9,winnie:10,polly:11,lmd:14};

const adj={},mm={};
D.forEach(m=>{adj[m.id]=[];mm[m.id]=m});
PC.forEach(([p,c])=>{adj[p].push({to:c,t:'c'});adj[c].push({to:p,t:'p'})});
SP.forEach(([a,b])=>{adj[a].push({to:b,t:'s'});adj[b].push({to:a,t:'s'})});

function bfs(a,b){
 if(a===b)return[];
 const q=[[a,[]]],v=new Set([a]);
 while(q.length){const[c,p]=q.shift();for(const e of adj[c]){if(v.has(e.to))continue;const np=[...p,{f:c,to:e.to,t:e.t}];if(e.to===b)return np;v.add(e.to);q.push([e.to,np])}}
 return null;
}
function ch(p){return p.map(s=>(s.t==='p'?'P':s.t==='c'?'C':'S')+mm[s.to].g).join('')}
function el(a,b){return(AGE[a]??SIB[a]??99)<(AGE[b]??SIB[b]??99)}
function T(z,en,fr,ct){return{zh:z,en:en,fr:fr||'',ct:ct||''}}

function kin(a,b,noSp){
 if(a===b)return T('Ëá™Â∑±','Self','Soi-m√™me','Ëá™Â∑±');
 const p=bfs(a,b);if(!p)return T('ÁÑ°Èóú‰øÇ','No relation','Aucun lien','ÂÜáÈóú‰øÇ');
 const c=ch(p),to=mm[b],fr=mm[a];
 const S={
  PM:['Áà∏Áà∏','Father','P√®re','ËÄÅÁ´á/Áà∏Áà∏'],PF:['Â™ΩÂ™Ω','Mother','M√®re','ËÄÅÊØç/Â™ΩÂí™'],
  CM:['ÂÖíÂ≠ê','Son','Fils','‰ªî'],CF:['Â•≥ÂÖí','Daughter','Fille','Â•≥'],
  SM:['ËÄÅÂÖ¨','Husband','Mari','ËÄÅÂÖ¨'],SF:['ËÄÅÂ©Ü','Wife','Femme','ËÄÅÂ©Ü'],
  PMPM:['Áà∫Áà∫','Grandfather','Grand-p√®re paternel','ÈòøÁà∫'],PMPF:['Â•∂Â•∂','Grandmother','Grand-m√®re paternelle','Â´≤Â´≤'],
  PFPM:['Â§ñÂÖ¨','Grandfather(M)','Grand-p√®re maternel','ÂÖ¨ÂÖ¨'],PFPF:['Â§ñÂ©Ü','Grandmother(M)','Grand-m√®re maternelle','Â©ÜÂ©Ü'],
  CMCM:['Â≠´Â≠ê','Grandson','Petit-fils','Â≠´'],CMCF:['Â≠´Â•≥','Granddaughter','Petite-fille','Â≠´Â•≥'],
  CFCM:['Â§ñÂ≠´','Grandson(D)','Petit-fils(fille)','Â§ñÂ≠´'],CFCF:['Â§ñÂ≠´Â•≥','Granddaughter(D)','Petite-fille(fille)','Â§ñÂ≠´Â•≥'],
  CMSF:['Â™≥Â©¶','Daughter-in-law','Belle-fille','Êñ∞Êä±'],CFSM:['Â•≥Â©ø','Son-in-law','Gendre','Â•≥Â©ø'],
  SMPM:['ÂÖ¨ÂÖ¨','Father-in-law','Beau-p√®re','ËÄÅÁà∫'],SMPF:['Â©ÜÂ©Ü','Mother-in-law','Belle-m√®re','Â•∂Â•∂'],
  SFPM:['Â≤≥Áà∂','Father-in-law','Beau-p√®re','Â§ñÁà∂'],SFPF:['Â≤≥ÊØç','Mother-in-law','Belle-m√®re','Â§ñÊØç'],
  PMPMPM:['ÊõæÁ•ñÁà∂','Great-Grandfather','Arri√®re-grand-p√®re','Â§™ÂÖ¨'],PMPMPF:['ÊõæÁ•ñÊØç','Great-Grandmother','Arri√®re-grand-m√®re','Â§™Â©Ü'],
  PMPFPM:['Â§ñÊõæÁ•ñÁà∂','Great-Grandfather(M)','Arri√®re-grand-p√®re(M)','Â§™ÂÖ¨(Â§ñ)'],PMPFPF:['Â§ñÊõæÁ•ñÊØç','Great-Grandmother(M)','Arri√®re-grand-m√®re(M)','Â§™Â©Ü(Â§ñ)'],
  CMCMCM:['ÊõæÂ≠´','Great-Grandson','Arri√®re-petit-fils','ÊõæÂ≠´'],CMCMCF:['ÊõæÂ≠´Â•≥','Great-Granddaughter','Arri√®re-petite-fille','ÊõæÂ≠´Â•≥'],
  CMCFCM:['Â§ñÊõæÂ≠´','Great-Grandson(D)','Arri√®re-petit-fils(D)','Â§ñÊõæÂ≠´'],CMCFCF:['Â§ñÊõæÂ≠´Â•≥','Great-Granddaughter(D)','Arri√®re-petite-fille(D)','Â§ñÊõæÂ≠´Â•≥'],
  CFCMCM:['Â§ñÊõæÂ≠´','Great-Grandson(D)','Arri√®re-petit-fils(D)','Â§ñÊõæÂ≠´'],CFCMCF:['Â§ñÊõæÂ≠´Â•≥','Great-Granddaughter(D)','Arri√®re-petite-fille(D)','Â§ñÊõæÂ≠´Â•≥'],
  CFCFCM:['Â§ñÊõæÂ≠´','Great-Grandson(D)','Arri√®re-petit-fils(D)','Â§ñÊõæÂ≠´'],CFCFCF:['Â§ñÊõæÂ≠´Â•≥','Great-Granddaughter(D)','Arri√®re-petite-fille(D)','Â§ñÊõæÂ≠´Â•≥'],
 };
 if(S[c])return T(S[c][0],S[c][1],S[c][2],S[c][3]);

 // siblings
 if(/^P[MF]C[MF]$/.test(c)){
  if(to.g==='M')return el(b,a)?T('Âì•Âì•','Elder Brother','Fr√®re a√Æn√©','Â§ß‰Ω¨/ÈòøÂì•'):T('ÂºüÂºü','Younger Brother','Petit fr√®re','Á¥∞‰Ω¨');
  return el(b,a)?T('ÂßêÂßê','Elder Sister','Grande s≈ìur','ÂÆ∂Âßê'):T('Â¶πÂ¶π','Younger Sister','Petite s≈ìur','Á¥∞Â¶π');
 }
 // uncle/aunt
 if(/^P[MF]P[MF]C[MF]$/.test(c)){
  const pat=c[1]==='M';
  if(pat){if(to.g==='M')return el(b,p[0].to)?T('‰ºØÁà∂','Uncle(Elder)','Oncle paternel a√Æn√©','‰ºØÁà∂'):T('ÂèîÂèî','Uncle(Younger)','Oncle paternel cadet','ÂèîÂèî');return T('ÂßëÂßë','Paternal Aunt','Tante paternelle','ÂßëÂ™Ω');}
  return to.g==='M'?T('ËàÖËàÖ','Maternal Uncle','Oncle maternel','ËàÖÁà∂'):T('ÈòøÂß®','Maternal Aunt','Tante maternelle','ÈòøÂß®');
 }
 // uncle/aunt's spouse
 if(/^P[MF]P[MF]C[MF]S[MF]$/.test(c)){
  const pat=c[1]==='M',sib=mm[p[2].to];
  if(pat){if(sib.g==='M')return el(sib.id,p[0].to)?T('‰ºØÊØç','Uncle\'s Wife(E)','Tante(oncle a√Æn√©)','‰ºØÂ®ò'):T('Â¨∏Â¨∏','Uncle\'s Wife(Y)','Tante(oncle cadet)','Â¨∏Â¨∏');return T('Âßë‰∏à','Aunt\'s Husband','Oncle(mari tante)','Âßë‰∏à');}
  return sib.g==='M'?T('ËàÖÂ™Ω','Uncle\'s Wife(M)','Tante(oncle M)','ËàÖÊØç'):T('Âß®‰∏à','Aunt\'s Husband(M)','Oncle(mari tante M)','Âß®‰∏à');
 }
 // cousins
 if(/^P[MF]P[MF]C[MF]C[MF]$/.test(c)){
  const pat=c[1]==='M',mid=mm[p[2].to],tang=pat&&mid.g==='M',e=el(b,a),pf=tang?'Â†Ç':'Ë°®';
  if(to.g==='M')return e?T(pf+'Âì•','Cousin(M,E)','Cousin a√Æn√©',pf+'Â§ß‰Ω¨'):T(pf+'Âºü','Cousin(M,Y)','Cousin cadet',pf+'Á¥∞‰Ω¨');
  return e?T(pf+'Âßê','Cousin(F,E)','Cousine a√Æn√©e',pf+'ÂÆ∂Âßê'):T(pf+'Â¶π','Cousin(F,Y)','Cousine cadette',pf+'Á¥∞Â¶π');
 }
 // nephew/niece
 if(/^P[MF]C[MF]C[MF]$/.test(c)){
  const sib=mm[p[1].to];
  if(sib.g==='M')return to.g==='M'?T('‰æÑÂ≠ê','Nephew(B)','Neveu','‰æÑ‰ªî'):T('‰æÑÂ•≥','Niece(B)','Ni√®ce','‰æÑÂ•≥');
  return to.g==='M'?T('Â§ñÁî•','Nephew(S)','Neveu(s≈ìur)','Â§ñÁî•'):T('Â§ñÁî•Â•≥','Niece(S)','Ni√®ce(s≈ìur)','Â§ñÁî•Â•≥');
 }
 // sibling's spouse
 if(/^P[MF]C[MF]S[MF]$/.test(c)){
  const sib=mm[p[1].to],e=el(sib.id,a);
  if(sib.g==='M')return e?T('Â´ÇÂ´Ç','Elder Bro\'s Wife','Belle-s≈ìur(fr√®re a√Æn√©)','ÈòøÂ´Ç'):T('ÂºüÂ™≥','Younger Bro\'s Wife','Belle-s≈ìur(fr√®re cadet)','ÂºüÂ©¶');
  return e?T('ÂßêÂ§´','Elder Sis\'s Husband','Beau-fr√®re(s≈ìur a√Æn√©e)','ÂßêÂ§´'):T('Â¶πÂ§´','Younger Sis\'s Husband','Beau-fr√®re(s≈ìur cadette)','Â¶πÂ§´');
 }
 // spouse's sibling
 if(/^S[MF]P[MF]C[MF]$/.test(c)){
  const sp=mm[p[0].to];
  if(sp.g==='M'){return to.g==='M'?(el(b,sp.id)?T('Â§ß‰ºØ','H\'s Elder Bro','Beau-fr√®re a√Æn√©','Â§ß‰ºØ'):T('Â∞èÂèî','H\'s Younger Bro','Beau-fr√®re cadet','Âèî‰ªî')):T('ÂßëÂ≠ê','H\'s Sister','Belle-s≈ìur','ÂßëÂ•∂');}
  return to.g==='M'?T('ËàÖÂ≠ê','W\'s Brother','Beau-fr√®re','ËàÖ‰ªî'):(el(b,sp.id)?T('Â§ßÂß®Â≠ê','W\'s Elder Sis','Belle-s≈ìur a√Æn√©e','Â§ßÂß®'):T('Â∞èÂß®Â≠ê','W\'s Younger Sis','Belle-s≈ìur cadette','Á¥∞Âß®'));
 }

 // === Gen3 ‚Üî Gen1 ===
 if(/^P[MF]P[MF]P[MF]C[MF]$/.test(c)){
  const anc=p[1].to;
  if(to.g==='M')return el(b,anc)?T('‰ºØÂÖ¨','Grand-Uncle(E)','Grand-oncle a√Æn√©','‰ºØÂÖ¨'):T('ÂèîÂÖ¨','Grand-Uncle(Y)','Grand-oncle cadet','ÂèîÂÖ¨');
  return T('ÂßëÂ©Ü','Grand-Aunt','Grand-tante','ÂßëÂ©Ü');
 }
 if(/^P[MF]P[MF]P[MF]C[MF]S[MF]$/.test(c)){
  const sib=mm[p[3].to],anc=p[1].to;
  if(sib.g==='M')return el(sib.id,anc)?T('‰ºØÂ©Ü','Grand-Uncle\'s Wife(E)','Gd-tante(oncle a√Æn√©)','‰ºØÂ©Ü'):T('Â¨∏Â©Ü','Grand-Uncle\'s Wife(Y)','Gd-tante(oncle cadet)','Â¨∏Â©Ü');
  return T('Âßë‰∏àÂÖ¨','Grand-Aunt\'s Husband','Grand-oncle(mari)','Âßë‰∏àÂÖ¨');
 }
 if(/^P[MF]C[MF]C[MF]C[MF]$/.test(c)){
  const sib=mm[p[1].to];
  if(sib.g==='M')return to.g==='M'?T('‰æÑÂ≠´','Grand-Nephew(B)','Petit-neveu','‰æÑÂ≠´'):T('‰æÑÂ≠´Â•≥','Grand-Niece(B)','Petite-ni√®ce','‰æÑÂ≠´Â•≥');
  return to.g==='M'?T('Â§ñÁî•Â≠´','Grand-Nephew(S)','Petit-neveu(S)','Â§ñÁî•Â≠´'):T('Â§ñÁî•Â≠´Â•≥','Grand-Niece(S)','Petite-ni√®ce(S)','Â§ñÁî•Â≠´Â•≥');
 }

 // === Gen3 ‚Üî Gen2 cross-branch ===
 if(/^P[MF]P[MF]P[MF]C[MF]C[MF]$/.test(c)){
  const gen1=mm[p[3].to],pf=gen1.g==='M'?'Â†Ç':'Ë°®',anc=p[0].to;
  if(to.g==='M')return el(b,anc)?T(pf+'‰ºØ',pf+'-Uncle(E)',pf==='Â†Ç'?'Cousin-oncle a√Æn√©':'Cousin-oncle a√Æn√©(M)',pf+'‰ºØ'):T(pf+'Âèî',pf+'-Uncle(Y)',pf==='Â†Ç'?'Cousin-oncle cadet':'Cousin-oncle cadet(M)',pf+'Âèî');
  return T(pf+'Âßë',pf+'-Aunt',pf==='Â†Ç'?'Cousine-tante':'Cousine-tante(M)',pf+'Âßë');
 }
 if(/^P[MF]P[MF]P[MF]C[MF]C[MF]S[MF]$/.test(c)){
  const gen1=mm[p[3].to],gen2=mm[p[4].to],pf=gen1.g==='M'?'Â†Ç':'Ë°®',anc=p[0].to;
  if(gen2.g==='M')return el(gen2.id,anc)?T(pf+'‰ºØÊØç',pf+'-Uncle\'s Wife(E)','Tante(cousin-oncle)',pf+'‰ºØÂ®ò'):T(pf+'Â¨∏',pf+'-Uncle\'s Wife(Y)','Tante(cousin-oncle)',pf+'Â¨∏');
  return T(pf+'Âßë‰∏à',pf+'-Aunt\'s Husband','Oncle(cousine-tante)',pf+'Âßë‰∏à');
 }
 if(/^P[MF]P[MF]C[MF]C[MF]C[MF]$/.test(c)){
  const gen1=mm[p[0].to],pf=gen1.g==='M'?'Â†Ç':'Ë°®';
  return to.g==='M'?T(pf+'‰æÑ',pf+'-Nephew','Cousin-neveu',pf+'‰æÑ'):T(pf+'‰æÑÂ•≥',pf+'-Niece','Cousine-ni√®ce',pf+'‰æÑÂ•≥');
 }
 // cousin's spouse
 if(/^P[MF]P[MF]C[MF]C[MF]S[MF]$/.test(c)){
  const mid2=mm[p[2].to],tang=c[1]==='M'&&mid2.g==='M',pf=tang?'Â†Ç':'Ë°®',cuz=mm[p[3].to];
  if(cuz.g==='F')return el(cuz.id,a)?T(pf+'ÂßêÂ§´','Cousin\'s H(E)','Beau-cousin',pf+'ÂßêÂ§´'):T(pf+'Â¶πÂ§´','Cousin\'s H(Y)','Beau-cousin',pf+'Â¶πÂ§´');
  return el(cuz.id,a)?T(pf+'Â´Ç','Cousin\'s W(E)','Belle-cousine',pf+'Â´Ç'):T(pf+'ÂºüÂ™≥','Cousin\'s W(Y)','Belle-cousine',pf+'ÂºüÂ©¶');
 }
 // in-law sibling's children
 if(/^S[MF]P[MF]C[MF]C[MF]$/.test(c)){
  const sib=mm[p[2].to];
  if(sib.g==='M')return to.g==='M'?T('‰æÑÂ≠ê','Nephew','Neveu','‰æÑ‰ªî'):T('‰æÑÂ•≥','Niece','Ni√®ce','‰æÑÂ•≥');
  return to.g==='M'?T('Â§ñÁî•','Nephew','Neveu','Â§ñÁî•'):T('Â§ñÁî•Â•≥','Niece','Ni√®ce','Â§ñÁî•Â•≥');
 }
 if(/^S[MF]C[MF]$/.test(c))return to.g==='M'?T('ÂÖíÂ≠ê','Son','Fils','‰ªî'):T('Â•≥ÂÖí','Daughter','Fille','Â•≥');
 if(/^S[MF]C[MF]C[MF]$/.test(c))return to.g==='M'?T('Â≠´Â≠ê','Grandson','Petit-fils','Â≠´'):T('Â≠´Â•≥','Granddaughter','Petite-fille','Â≠´Â•≥');
 if(/^C[MF]S[MF]$/.test(c))return to.g==='M'?T('Â•≥Â©ø','Son-in-law','Gendre','Â•≥Â©ø'):T('Â™≥Â©¶','Daughter-in-law','Belle-fille','Êñ∞Êä±');

 // spouse delegation
 if(/^S[MF]/.test(c)&&c.length>=4&&!noSp){
  const r=kin(p[0].to,b,true);
  if(r.zh!=='Ë¶™Êàö')return r;
 }

 // generation fallback
 const gd=to.gen-fr.gen;
 if(gd===-1)return to.g==='M'?T('Âèî‰ºØËº©','Elder(Uncle gen)','Oncle(g√©n.)','Âèî‰ºØËº©'):T('ÂßëÂß®Ëº©','Elder(Aunt gen)','Tante(g√©n.)','ÂßëÂß®Ëº©');
 if(gd===1)return to.g==='M'?T('‰æÑËº©','Junior(Nephew gen)','Neveu(g√©n.)','‰æÑËº©'):T('‰æÑÂ•≥Ëº©','Junior(Niece gen)','Ni√®ce(g√©n.)','‰æÑÂ•≥Ëº©');
 if(gd===-2)return T('Á•ñËº©','Grandparent gen','Grands-parents(g√©n.)','Á•ñËº©');
 if(gd===2)return T('Â≠´Ëº©','Grandchild gen','Petits-enfants(g√©n.)','Â≠´Ëº©');
 if(gd===0)return T('Âπ≥Ëº©','Same generation','M√™me g√©n√©ration','Âπ≥Ëº©');
 return T('Ë¶™Êàö','Relative','Parent','Ë¶™Êàö');
}

const branches=[
 {g1:['fa','mo'],subs:[{p:'ego',sp:'csh',k:['wjy','cpy']},{p:'wyx2',sp:null,k:[]}]},
 {g1:['dagu','daguh'],subs:[{p:'psw',sp:'psww',k:[]},{p:'psk',sp:'pskw',k:['pk1','pk2']}]},
 {g1:['ersh','ershw'],subs:[{p:'wzc',sp:'wxw',k:['wmz','wmy','wts']},{p:'wyx',sp:'jay',k:['cc']},{p:'wyw',sp:'michael',k:['mila']},{p:'wyh',sp:'nick',k:['bd','le']}]},
 {g1:['sansh','sanshw'],subs:[{p:'wyj',sp:'antoine',k:['ali']},{p:'wzg',sp:'winnie',k:['sz','mochi']}]},
 {g1:['xgu','xguh'],subs:[{p:'lya',sp:'polly',k:[]},{p:'ljy',sp:null,k:[]}]},
 {g1:['xsh','xshw'],subs:[{p:'wyq',sp:null,k:[]},{p:'wzh',sp:'lmd',k:['mnt']}]},
];

function mkP(m,cls){
 const d=document.createElement('div');d.className='p'+(cls?' '+cls:'')+(m.d?' dead':'');d.dataset.id=m.id;
 d.innerHTML=`<div class="a ${m.g==='M'?'m':'f'}">${m.g==='M'?'üë®':'üë©'}</div><div class="n">${m.n}</div>${m.e?'<div class="en">'+m.e+'</div>':''}`;
 d.onclick=()=>click(m.id);return d;
}

function render(){
 const r0=document.getElementById('g0'),c0=document.createElement('div');c0.className='cp';
 c0.appendChild(mkP(mm.gf));c0.appendChild(mkP(mm.gm));r0.appendChild(c0);
 const r1=document.getElementById('g12');
 branches.forEach(br=>{
  const col=document.createElement('div');col.className='branch';
  const cp=document.createElement('div');cp.className='cp';
  cp.appendChild(mkP(mm[br.g1[0]]));cp.appendChild(mkP(mm[br.g1[1]]));
  col.appendChild(cp);
  const sf=document.createElement('div');sf.className='subfams';
  br.subs.forEach(sub=>{
   const f=document.createElement('div');f.className='subfam';
   const sc=document.createElement('div');sc.className='cp';
   sc.appendChild(mkP(mm[sub.p]));
   if(sub.sp)sc.appendChild(mkP(mm[sub.sp]));
   f.appendChild(sc);
   if(sub.k.length){
    const kd=document.createElement('div');kd.className='kids';
    sub.k.forEach(kid=>kd.appendChild(mkP(mm[kid],'g3')));
    f.appendChild(kd);
   }
   sf.appendChild(f);
  });
  col.appendChild(sf);
  r1.appendChild(col);
 });
 requestAnimationFrame(drawLines);
}

function ctr(id){const e=document.querySelector(`[data-id="${id}"] .a`);if(!e)return null;const s=document.getElementById('L').getBoundingClientRect(),r=e.getBoundingClientRect();return{x:r.left+r.width/2-s.left,y:r.top+r.height/2-s.top}}
function mid(a,b){const p=ctr(a),q=ctr(b);return p&&q?{x:(p.x+q.x)/2,y:(p.y+q.y)/2}:null}

function drawLines(){
 const svg=document.getElementById('L'),tree=document.getElementById('tree');
 svg.setAttribute('width',tree.scrollWidth);svg.setAttribute('height',tree.scrollHeight);svg.innerHTML='';
 SP.forEach(([a,b])=>{const p=ctr(a),q=ctr(b);if(!p||!q)return;const l=document.createElementNS('http://www.w3.org/2000/svg','line');l.setAttribute('x1',p.x);l.setAttribute('y1',p.y);l.setAttribute('x2',q.x);l.setAttribute('y2',q.y);svg.appendChild(l)});
 const gp=mid('gf','gm');
 if(gp)branches.forEach(br=>{
  const cp=mid(br.g1[0],br.g1[1]);if(!cp)return;
  const my=(gp.y+24+cp.y-24)/2;
  const d=document.createElementNS('http://www.w3.org/2000/svg','path');
  d.setAttribute('d',`M${gp.x},${gp.y+24}L${gp.x},${my}L${cp.x},${my}L${cp.x},${cp.y-24}`);svg.appendChild(d);
 });
 branches.forEach(br=>{
  const cp1=mid(br.g1[0],br.g1[1]);if(!cp1)return;
  br.subs.forEach(sub=>{
   const pt=sub.sp?mid(sub.p,sub.sp):ctr(sub.p);if(!pt)return;
   const my=(cp1.y+24+pt.y-24)/2;
   const d=document.createElementNS('http://www.w3.org/2000/svg','path');
   d.setAttribute('d',`M${cp1.x},${cp1.y+24}L${cp1.x},${my}L${pt.x},${my}L${pt.x},${pt.y-24}`);svg.appendChild(d);
   sub.k.forEach(kid=>{
    const kp=ctr(kid);if(!kp)return;
    const my2=(pt.y+24+kp.y-24)/2;
    const d2=document.createElementNS('http://www.w3.org/2000/svg','path');
    d2.setAttribute('d',`M${pt.x},${pt.y+24}L${pt.x},${my2}L${kp.x},${my2}L${kp.x},${kp.y-18}`);svg.appendChild(d2);
   });
  });
 });
}

let sA=null,sB=null;
function click(id){
 if(!sA){sA=id;hi();showSbar(`Â∑≤ÈÅ∏ <span class="badge ba">A</span> <b>${mm[id].n}</b>ÔºåË´ãÈªûÈÅ∏ B`);}
 else if(!sB&&id!==sA){sB=id;hi();showModal();}
 else{sA=id;sB=null;hi();showSbar(`Â∑≤ÈÅ∏ <span class="badge ba">A</span> <b>${mm[id].n}</b>ÔºåË´ãÈªûÈÅ∏ B`);}
 document.getElementById('btn').style.display='block';
}
function hi(){
 document.querySelectorAll('.p').forEach(e=>{e.classList.remove('sa','sb');e.querySelector('.badge')?.remove()});
 if(sA){const e=document.querySelector(`[data-id="${sA}"]`);e.classList.add('sa');e.insertAdjacentHTML('beforeend','<span class="badge ba">A</span>')}
 if(sB){const e=document.querySelector(`[data-id="${sB}"]`);e.classList.add('sb');e.insertAdjacentHTML('beforeend','<span class="badge bb">B</span>')}
}
function showSbar(h){const b=document.getElementById('sbar');b.style.display='block';b.innerHTML=h}
function showModal(){
 const k=kin(sA,sB);
 const an=mm[sA].n+(mm[sA].e?' ('+mm[sA].e+')':'');
 const bn=mm[sB].n+(mm[sB].e?' ('+mm[sB].e+')':'');
 document.getElementById('mdl').innerHTML=`
  <div class="who"><span class="badge ba">A</span> <b>${an}</b> Âè´ <span class="badge bb">B</span> <b>${bn}</b></div>
  <div class="main-term">${k.zh}</div>
  <div class="lang-row">
   <div class="lang"><div class="label">English</div><div class="val">${k.en}</div></div>
   <div class="lang"><div class="label">Fran√ßais</div><div class="val">${k.fr}</div></div>
   <div class="lang"><div class="label">Á≤µË™û</div><div class="val">${k.ct}</div></div>
  </div>
  <button class="close-btn" onclick="closeM()">ÈóúÈñâ</button>`;
 document.getElementById('mbg').classList.add('show');
 document.getElementById('sbar').style.display='none';
}
function closeM(e){if(!e||e.target===document.getElementById('mbg')){document.getElementById('mbg').classList.remove('show')}}
function reset(){sA=sB=null;hi();document.getElementById('sbar').style.display='none';document.getElementById('btn').style.display='none';document.getElementById('mbg').classList.remove('show')}

window.onload=()=>{render();window.onresize=drawLines};
</script>
</body>
</html>